<!DOCTYPE html>
<html>
    <head>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="//cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
        <script>
            $(function() {
                var conn = null;

                function log(msg) {
                    var control = $('#log');
                    control.html(control.html() + msg + '<br/>');
                    control.scrollTop(control.scrollTop() + 1000);
                }

                function disconnect() {
                    if (conn != null) {
                        log('Disconnecting...');

                        conn.close();
                        conn = null;

                        updateUi();
                    }
                }

                function updateUi() {
                    if (conn == null || conn.readyState != SockJS.OPEN) {
                        $('#status').text('disconnected');
                        $('#connect').text('Connect');
                    }
                    else {
                        $('#status').text('connected');
                        $('#connect').text('Disconnect');
                    }
                }

                $('form').submit(function() {
                    var text = $('#message').val();
                    conn.send(text);
                    $('#message').val('').focus();
                    return false;
                });

                conn = new SockJS('http://' + window.location.host + '/universe');
                log('Connecting...');

                conn.onopen = function() {
                    log('Connected.');
                    updateUi();
                };

                conn.onmessage = function(e) {
                    log(e.data);
                };

                conn.onclose = function() {
                    log('Disconnected.');
                    conn = null;
                    updateUi();
                };

                $('#message').val('').focus();
            });
        </script>
        <title>War Cluster Development shell</title>
    </head>
    <body>
        <h1>War Cluster Development shell</h1>

        <div>
            Status: <span id="status">disconnected</span>
        </div>
        <div id="log" style="width: 80em; height: 30em; overflow:auto; border: 1px solid black">
        </div>
        <form id="chatform">
            <label for="message">Command:</label>
            <input id="message" type="text" style="width: 80em">
            <input type="submit" value="Send">
        </form>
    </body>
</html>
