<!DOCTYPE html>
<html>
    <head>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="//cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
        <script>
            $(function() {
                var conn = null;

                function setup_parameters() {
                    alert("wtf");
                }

                function log(msg) {
                    var control = $('#json');
                    try {
                        var prettyMessage = JSON.stringify(JSON.parse(msg), undefined, 2);
                        control.html($("#json").html() + "<br/>" + prettyMessage + "<br/>-----------------------------------");
                    } catch (e) {
                        control.html(control.html() + msg + '<br/>');
                    }
                    control.scrollTop(control.scrollTop() + 1000);
                }

                function disconnect() {
                    if (conn != null) {
                        log('Disconnecting...');

                        conn.close();
                        conn = null;

                        updateUi();
                    }
                }

                function updateUi() {
                    if (conn == null || conn.readyState != SockJS.OPEN) {
                        $('#status').text('disconnected');
                        $('#connect').text('Connect');
                    }
                    else {
                        $('#status').text('connected');
                        $('#connect').text('Disconnect');
                    }
                }

                $('#chatform').submit(function() {
                    var text = $('#message').val();
                    conn.send(text);
                    $('#message').val('').focus();
                    return false;
                });

                $('#loginform').submit(function() {
                    var text = {
                        "Command": "login",
                        "Username": $('#loginName').val(),
                        "TwitterId": "some twitter ID"
                    }
                    conn.send(JSON.stringify(text));
                    return false;
                });

                $('#paramsform').submit(function() {
                    var text = {
                        "Command": "setup_parameters",
                        "Race": parseInt($('#race').val()),
                        "SunTextureId": parseInt($('#sunTextureId').val())
                    }
                    conn.send(JSON.stringify(text));
                    return false;
                });


                conn = new SockJS('http://' + window.location.host + '/universe');
                log('Connecting...');

                conn.onopen = function() {
                    log('Connected.');
                    updateUi();
                };

                conn.onmessage = function(e) {
                    log(e.data);
                };

                conn.onclose = function() {
                    log('Disconnected.');
                    conn = null;
                    updateUi();
                };

                $('#message').val('').focus();
            });
        </script>
        <title>War Cluster Development shell</title>
    </head>
    <body>
        <h1>War Cluster Development shell</h1>

        <div>
            Status: <span id="status">disconnected</span>
        </div>
        <pre id="json" style="width: 90%; height: 30em; overflow:auto; border: 1px solid black">
        </pre>
        <form id="chatform">
            <label for="message">Command:</label>
            <input id="message" type="text" style="width: 80%">
            <input type="submit" value="Send">
        </form>
        <form id="loginform">
            Login with:
            <input id="loginName" type="text" value="john">
            <input type="submit" value="login">
        </form>
        <form id="paramsform">
            Request params ->
            <input type="submit" value="setup_parameters">
            Race: <input id="race" type="text" value="0">
            SunTextureId:  <input id="sunTextureId" type="text" value="0">
        </form>
    </body>
</html>
